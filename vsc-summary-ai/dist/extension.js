"use strict";var y=Object.create;var l=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var v=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var b=(e,s)=>{for(var t in s)l(e,t,{get:s[t],enumerable:!0})},u=(e,s,t,r)=>{if(s&&typeof s=="object"||typeof s=="function")for(let a of S(s))!k.call(e,a)&&a!==t&&l(e,a,{get:()=>s[a],enumerable:!(r=g(s,a))||r.enumerable});return e};var m=(e,s,t)=>(t=e!=null?y(v(e)):{},u(s||!e||!e.__esModule?l(t,"default",{value:e,enumerable:!0}):t,e)),C=e=>u(l({},"__esModule",{value:!0}),e);var x={};b(x,{activate:()=>M,deactivate:()=>I});module.exports=C(x);var w=m(require("vscode"));var n=m(require("vscode")),h=m(require("child_process")),c=m(require("path")),p=require("fs"),d=null;function P(){if(d)return;let e=c.join(__dirname,"..","flask_backend","assistant.py"),s=c.join(__dirname,"..","..",".venv","bin","python");d=h.spawn(s,[e],{cwd:c.dirname(e),detached:!0,stdio:"inherit"}),d.unref(),console.log("\u{1F680} Flask backend started.")}function R(){return fetch("http://127.0.0.1:5001",{method:"GET"}).then(e=>e.ok).catch(()=>!1)}function F(e=10,s=500){return new Promise(t=>{let r=async a=>{await R()?t(!0):a>0?setTimeout(()=>r(a-1),s):t(!1)};r(e)})}async function f(){let e=n.window.createOutputChannel("VSC Summary AI");if(await n.window.showInformationMessage("Welcome to VSC Summary AI",{modal:!0},"Select Repository")==="Select Repository"){let t="",r=!1;for(;!r;){let o=await n.window.showOpenDialog({canSelectMany:!1,canSelectFiles:!1,canSelectFolders:!0,openLabel:"Select Folder"});if(o&&o[0]){t=o[0].fsPath;let i=c.join(t,".git");if(p.existsSync(i)&&p.lstatSync(i).isDirectory())r=!0,console.log("Repository set: ",t);else if(await n.window.showWarningMessage("The selected folder is not a Git repository.","Try Again","Cancel")==="Cancel")break}}if(t===""&&n.window.showWarningMessage("No repository is selected."),P(),!await F()){n.window.showErrorMessage("Flask backend is not running.");return}fetch("http://127.0.0.1:5001/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({repo_path:t})}).then(o=>o.json()).then(o=>{let i=o;i.summary?(n.window.showInformationMessage("Summary generated!"),e.appendLine(i.summary),e.show()):n.window.showErrorMessage(i.error||"Something went wrong.")}).catch(o=>{n.window.showErrorMessage(`Request failed: ${o.message}`)})}}function M(e){console.log("VSC Summary AI is now active!");let s=w.commands.registerCommand("vsc-summary-ai.summarise",f);e.subscriptions.push(s)}function I(){}0&&(module.exports={activate,deactivate});
